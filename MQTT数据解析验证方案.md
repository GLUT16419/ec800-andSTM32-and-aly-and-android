# MQTT数据解析真机调试验证方案

## 一、准备工作

### 1. 确保应用配置正确
- 检查`MqttService.kt`中的阿里云连接参数（ProductKey、DeviceName、DeviceSecret）是否正确
- 确认应用已获得必要权限：`INTERNET`、`ACCESS_NETWORK_STATE`等
- 确保真机已连接到可用网络（WiFi或移动数据）

### 2. 开启详细日志
- 确保应用的日志级别设置为`DEBUG`
- 关注以下关键日志标签：
  - `MQTT连接成功`（连接状态）
  - `收到MQTT消息`（消息接收）
  - `解析结果 -> 设备:`（数据解析）
  - `updateDeviceData`（数据更新）

## 二、数据发送方式

### 方式1：通过阿里云物联网平台手动发送
1. 登录阿里云物联网平台控制台
2. 进入设备管理 -> 设备列表，找到目标设备
3. 点击「物模型数据」->「在线调试」
4. 选择「设置属性」，输入要发送的属性值（如温度、湿度等）
5. 点击「发送指令」，等待设备接收

### 方式2：使用MQTT客户端工具模拟发送
1. 使用MQTT客户端工具（如MQTT.fx、MQTT X）
2. 配置连接参数（使用与应用相同的ProductKey、DeviceName、DeviceSecret生成的MQTT连接参数）
3. 构造符合物模型格式的JSON消息
4. 发布到应用订阅的主题（通常是`/sys/{ProductKey}/{DeviceName}/thing/service/property/set`）

### 方式3：使用真实冷链设备发送数据
如果有真实的冷链设备，可以直接让设备发送数据到阿里云平台，应用会自动接收和解析

## 三、解析验证方法

### 1. 日志验证（推荐）
- 在Android Studio中打开Logcat，筛选应用包名`com.example.dgb`
- 查找以下日志：
  - 收到MQTT消息的原始数据
  - 解析后的设备数据（温度、湿度、氧气浓度等）
  - 数据更新成功的记录
- 检查解析结果是否与发送的数据一致

### 2. UI界面验证
- 打开应用的设备监控界面
- 检查显示的设备数据（温度、湿度、氧气浓度、位置等）是否与发送的数据一致
- 确认数据更新时间是否正确

### 3. 数据库验证
- 使用Android Studio的Database Inspector工具
- 连接到运行中的应用
- 查看`device_history`表中的最新记录
- 确认存储的数据是否与发送的数据一致

## 四、常见问题排查

### 1. 收不到MQTT消息
- 检查网络连接是否正常
- 确认阿里云平台上设备状态是否在线
- 检查MQTT主题是否正确订阅

### 2. 解析失败
- 查看日志中的解析错误信息
- 检查发送的JSON格式是否符合应用的解析逻辑
- 确认属性字段名称是否匹配（如"VehInsideTemp"、"mhumi"等）

### 3. 数据显示异常
- 检查解析后的数据类型转换是否正确
- 确认UI界面的数据绑定是否正确
- 检查数据库存储逻辑是否有问题

## 五、调试工具

1. **Android Studio Logcat**：查看应用运行日志
2. **阿里云物联网平台控制台**：监控设备状态和消息收发
3. **MQTT客户端工具**：模拟MQTT消息发送
4. **Database Inspector**：查看数据库中的存储数据

通过以上方案，可以全面验证MQTT数据解析在真机上的正确性和可靠性。